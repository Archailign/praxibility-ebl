# Enterprise Business Language (EBL) Definition
# Version: 1.2.0
# License: Apache-2.0
# Author: Innovate Marketing Agency
# Description: Enhanced EBL definition for ad campaign management with predictive budgeting in the ad tech domain, aligned with Archailign framework
# Domain: AdTech
# Conforms to: EBL-Spec-1.1

Metadata:
  EBLClass: AdCampaignManagement
  RequirementID: BR-001
  ProjectID: PRJ-ADTECH-001
  OrganisationID: ORG-002
  DomainID: DOM-ADTECH
  DepartmentID: DEPT-ADTECH-CAMPAIGN
  CreatedAt: 2025-10-24
  UpdatedAt: 2025-10-24

Entity AdCampaign {
  Properties:
    CampaignID: { type: UUID, required: true, unique: true, erMap: DataObject }
    Name: { type: String, required: true }
    Budget: { type: Currency, required: true }
    Status: { type: Enum, values: [Draft, Active, Completed, Paused, Optimized], default: Draft }
    ComplianceStatus: { type: Enum, values: [Compliant, NonCompliant], default: NonCompliant }
    RemainingBudget: { type: Currency, calculated: Budget - SpentAmount }
    PredictedBudget: { type: Currency, calculated: AutonomousEngine.PredictBudget(CampaignID) }
  Rules:
    - Budget must be > 0
    - RemainingBudget must be >= 0
  erMap: DataObject
}

Entity AdAudienceSegment {
  Properties:
    SegmentID: { type: UUID, required: true, unique: true, erMap: DataObject }
    Name: { type: String, required: true }
    Demographics: { type: JSON, required: true }
    Size: { type: Integer, required: true }
    PredictedSize: { type: Integer, calculated: AutonomousEngine.PredictAudienceSize(SegmentID) }
  Rules:
    - Size must be > 0
  erMap: DataObject
}

Entity AdPerformanceMetric {
  Properties:
    MetricID: { type: UUID, required: true, unique: true, erMap: DataObject }
    CampaignID: { type: UUID, required: true }
    CTR: { type: Ratio, required: true }
    ROI: { type: Ratio, required: true }
    ROAS: { type: Ratio, calculated: Revenue / SpentAmount }
    CPA: { type: Currency, calculated: SpentAmount / Conversions }
    Timestamp: { type: DateTime, required: true }
    AttributionModel: { type: Enum, values: [FirstTouch, LastTouch], default: LastTouch }
    PredictedCTR: { type: Ratio, calculated: AutonomousEngine.PredictCTR(CampaignID) }
    PredictedROAS: { type: Ratio, calculated: AutonomousEngine.PredictROAS(CampaignID) }
  Rules:
    - CTR must be between 0 and 1
    - ROAS must be >= 0
  erMap: DataObject
}

Entity AdCreative {
  Properties:
    CreativeID: { type: UUID, required: true, unique: true, erMap: DataObject }
    CampaignID: { type: UUID, required: true }
    Type: { type: Enum, values: [Banner, Video], required: true }
    Content: { type: String, required: true }
  Rules:
    - Content must not be empty
  erMap: DataObject
}

Entity AdPlatform {
  Properties:
    PlatformID: { type: UUID, required: true, unique: true, erMap: DataObject }
    Name: { type: String, required: true }
    APIKey: { type: String, required: true, sensitive: true }
  Rules:
    - APIKey must be encrypted
  erMap: DataObject
}

Process AdCampaignManagement {
  Description: Manages the end-to-end lifecycle of ad campaigns with predictive budgeting using Archailignâ€™s integrated framework
  ObjectiveID: OBJ-ADTECH-001
  BusinessGoalID: BG-ADTECH-001
  Actors: [MediaBuyer, DataAnalyst, AccountDirector, OperationsTeam]
  erMap: BusinessProcess

  Starts With: Event CampaignCreationRequested(AdCampaign)

  Step DefineCampaign {
    Inputs:
      - AdCampaign.Name
      - AdCampaign.Budget
      - AdAudienceSegment.SegmentID
    Validation:
      - AdCampaign.Budget > 0
      - AdAudienceSegment.Size > 0
    Service: ArchitectureAsCode.ProvisionInfrastructure(AdPlatform)
    Output:
      - CampaignDraft: Partial<AdCampaign>
  }

  Step IntegrateDataSources {
    Description: Aggregates and normalizes data from multiple ad platforms using Business Data & Ontology
    Inputs:
      - AdPlatform.PlatformID
    Service: AdPlatformAPI.Connect(AdPlatform.APIKey)
    Output:
      - IntegratedData: { Impressions: Integer, Clicks: Integer, Conversions: Integer }
  }

  Step ExecuteCampaign {
    Condition: AdCampaign.ComplianceStatus == "Compliant"
    Invoke: AutonomousEngine.Execute(AdCreative, AdAudienceSegment, IntegratedData)
    Service: AdPlatformAPI.LaunchCampaign(CampaignID, AdAudienceSegment)
    Output:
      - CampaignActive: Partial<AdCampaign>
  }

  Step MonitorPerformance {
    Description: Continuously tracks performance metrics with real-time and predictive updates
    Inputs:
      - AdPerformanceMetric
    Service: AdPlatformAPI.RetrieveAnalytics(CampaignID)
    Ruleset: AdTechComplianceRules
    Output:
      - PerformanceSnapshot: { CTR: Ratio, ROAS: Ratio, CPA: Currency, PredictedCTR: Ratio, PredictedROAS: Ratio }
  }

  Step PredictAndOptimize {
    Description: Leverages Autonomous Engine for predictive budgeting and optimization
    Invoke: AutonomousEngine.PredictPerformance(AdPerformanceMetric, AdCampaign)
    Service: ArchitectureAsCode.SimulateReallocation(AdCampaign, AdPerformanceMetric)
    Actions:
      - Update AdCampaign.PredictedBudget = AutonomousEngine.PredictBudget(CampaignID)
      - Condition: AdPerformanceMetric.PredictedROAS >= 3.5 AND AdPerformanceMetric.PredictedCTR > 0.025
        - Adjust AdCampaign.Budget += 5000
        - Update AdCampaign.Status = "Optimized"
      - Else
        - Set AdCampaign.Status = "Paused"
        - Send Notification BudgetAlert to MediaBuyer.Email
    Output:
      - OptimizedCampaign: Partial<AdCampaign>
  }

  Step GenerateReport {
    Description: Automates client-facing reports with predictive insights using Business Process
    Inputs:
      - PerformanceSnapshot
      - AdCampaign.PredictedBudget
    Service: ArchitectureAsCode.GenerateReport(PerformanceSnapshot, PredictedBudget)
    Output:
      - ClientReport: { Format: Enum[PDF, PPT], Scheduled: Boolean }
  }

  Ends With: Event CampaignOptimized(AdCampaign.CampaignID, AdPerformanceMetric, ClientReport)
}

Rule BudgetAlert {
  Description: Enforces Business Rules & Policies with predictive thresholds
  Trigger: AdCampaign.RemainingBudget < 1000 OR AdPerformanceMetric.CPA > 50 OR AdCampaign.PredictedBudget < 0
  Conditions:
    - AdCampaign.Status == "Active"
  Actions:
    - Send Notification BudgetAlert to MediaBuyer.Email
    - Send Notification BudgetAlert to MediaBuyer.Slack
    - Invoke AutonomousEngine.PauseCampaign(AdCampaign.CampaignID)
  erMap: Requirement
}

Report CampaignPerformance {
  Description: Real-time and predictive performance metrics aligned with Outcome and Capability
  Query:
    Select AdCampaign.CampaignID, Avg(AdPerformanceMetric.CTR), Avg(AdPerformanceMetric.PredictedCTR), Avg(AdPerformanceMetric.ROAS), Avg(AdPerformanceMetric.PredictedROAS), Sum(AdCampaign.Budget), Sum(AdCampaign.RemainingBudget), Avg(AdCampaign.PredictedBudget)
    From AdCampaign
    Join AdPerformanceMetric
    Where AdCampaign.Status = "Active"
    Group By AdCampaign.CampaignID
    Order By Avg(AdPerformanceMetric.PredictedROAS) Descending
  Schedule: Every 4 hours
  erMap: Application
}

Integration AdPlatformAPI {
  Provider: MultiPlatformAPI
  Credentials: SystemConfig.APIKey
  Operations:
    - Connect(PlatformID, APIKey)
    - LaunchCampaign(CampaignID, AdAudienceSegment)
    - RetrieveAnalytics(CampaignID, AdPerformanceMetric)
  ErrorHandling:
    - Log ErrorDetails
    - Notify OperationsTeam
  erMap: Application
}